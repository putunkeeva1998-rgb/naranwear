<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NARAN</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --accent: #e0dbda; 
            --bg: #ffffff; 
            --card-bg: #ffffff;
            --dark: #2d2d2d; 
            --gray: #775d5d; 
            --red: #523434; 
            --light-pink: rgba(255, 133, 162, 0.1); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; 
            background: var(--bg); 
            font-family: 'Montserrat', -apple-system, sans-serif; 
            color: var(--dark); 
            overflow-x: hidden; 
        }
        
        .header { 
            background: #fff; 
            padding: 20px 15px; 
            text-align: center; 
            border-bottom: 2px solid var(--light-pink); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }

        .brand-name { 
            font-size: 22px; 
            margin: 0; 
            font-weight: 800; 
            letter-spacing: -0.5px; 
            color: var(--dark);
        }

        .container { padding: 15px; padding-bottom: 110px; }

        .cat-row { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .cat-tab { 
            padding: 10px 20px; 
            border-radius: 25px; 
            border: 1.5px solid var(--accent); 
            background: #fff; 
            color: var(--accent); 
            font-size: 11px; 
            font-weight: 800; 
            white-space: nowrap;
            text-transform: uppercase;
        }
        .cat-tab.active { background: var(--accent); color: #fff; }

        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { 
            background: var(--card-bg); 
            border-radius: 20px; 
            overflow: hidden; 
            border: 1px solid rgba(255, 133, 162, 0.2); 
            position: relative; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 4px 15px rgba(255, 133, 162, 0.1); 
        }
        
        .slider-wrapper { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #fdfdfd; }
        .slider-inner { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; height: 100%; }
        .slider-inner::-webkit-scrollbar { display: none; }
        .slider-inner img { width: 100%; height: 100%; object-fit: cover; scroll-snap-align: start; flex-shrink: 0; }

        .dots { position: absolute; bottom: 8px; width: 100%; text-align: center; pointer-events: none; }
        .dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin: 0 3px; transition: 0.3s; }

        .fav-heart { 
            position: absolute; top: 10px; right: 10px; z-index: 10; 
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); 
            border-radius: 50%; width: 34px; height: 34px; 
            display: flex; align-items: center; justify-content: center; border: none;
        }
        .fav-heart svg { width: 18px; height: 18px; fill: none; stroke: var(--accent); stroke-width: 2.5px; }
        .fav-heart.active svg { fill: var(--red); stroke: var(--red); }

        .card-info { padding: 12px; text-align: center; }
        .card-title { font-size: 12px; font-weight: 700; margin-bottom: 6px; height: 30px; overflow: hidden; line-height: 1.2; }
        .card-price { color: var(--accent); font-weight: 800; font-size: 16px; margin-bottom: 10px; }
        
        .size-btns { display: flex; justify-content: center; gap: 4px; margin-bottom: 12px; }
        .s-btn { flex: 1; padding: 8px 0; border: 1px solid #eee; border-radius: 8px; font-size: 11px; font-weight: 800; background: #fff; }
        .s-btn.active { border-color: var(--accent); background: var(--light-pink); color: var(--accent); }

        .buy-btn { 
            width: 100%; padding: 12px; background: var(--accent); color: #fff; 
            border: none; border-radius: 12px; font-size: 10px; font-weight: 800; 
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; background: #fff; 
            display: flex; justify-content: space-around; padding: 10px 0 25px 0; 
            border-top: 1px solid var(--light-pink); z-index: 9999; 
        }
        .nav-item { border: none; background: none; color: var(--gray); display: flex; flex-direction: column; align-items: center; font-size: 9px; gap: 4px; width: 20%; font-weight: 600; }
        .nav-item.active { color: var(--accent); }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; }

        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding-bottom: 40px; }
        .close-m { position: fixed; top: 15px; left: 15px; width: 40px; height: 40px; border-radius: 50%; background: #fff; border: 1px solid #eee; z-index: 2100; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        .input-c { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #eee; font-size: 15px; background: #fdfdfd; font-family: inherit; }
        .order-btn { width: 100%; padding: 18px; background: var(--accent); color: #fff; border: none; border-radius: 18px; font-weight: 800; font-size: 16px; margin-top: 20px; box-shadow: 0 5px 15px rgba(255, 133, 162, 0.3); }
        
        #map { width: 100%; height: 250px; border-radius: 15px; margin-top: 10px; border: 1.5px solid var(--accent); }
        
        /* –°—Ç–∏–ª–∏ –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é */
        .side-menu {
            position: fixed; top: 0; left: 0; bottom: 0; width: 280px; 
            background: #fff; z-index: 3001; transition: 0.3s ease; 
            padding: 25px; box-shadow: 5px 0 15px rgba(0,0,0,0.1);
        }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000; }
    </style>
</head>
<body>

<div id="app">
    <div v-if="showMenu" class="overlay" @click="showMenu = false"></div>
    <div class="side-menu" :style="{ transform: showMenu ? 'translateX(0)' : 'translateX(-100%)' }">
        <button @click="showMenu = false" style="float:right; border:none; background:none; font-size:24px;">‚úï</button>
        <h2 class="brand-name" style="margin-bottom:30px;">NARAN</h2>
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <button @click="activeInfo = 'about'; showMenu = false" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700; color:var(--dark);">–û –Ω–∞—Å</button>
            <button @click="activeInfo = 'returns'; showMenu = false" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700; color:var(--dark);">–í–æ–∑–≤—Ä–∞—Ç</button>
            <button @click="activeInfo = 'delivery'; showMenu = false" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700; color:var(--dark);">–î–æ—Å—Ç–∞–≤–∫–∞</button>
        </div>
    </div>

    <div class="header" style="display: flex; align-items: center; justify-content: space-between;">
        <button @click="showMenu = true; vibrate()" style="border:none; background:none; padding:5px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        <h1 class="brand-name" style="flex: 1; text-align: center; margin-right: 34px;">NARAN</h1>
    </div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div class="cat-row">
                <button v-for="c in categories" :key="c" @click="currentCat = c; vibrate()" :class="['cat-tab', currentCat === c ? 'active' : '']">{{c}}</button>
                <button @click="currentCat = ''; vibrate()" :class="['cat-tab', currentCat === '' ? 'active' : '']">–í—Å–µ</button>
            </div>

            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card">
                    <button v-if="isAdmin" @click.stop="toggleHide(p)" style="position: absolute; top: 10px; left: 10px; z-index: 100; background: #fff; border: 1px solid #eee; border-radius: 50%; width: 30px; height: 30px;">
                        {{ p.hidden ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è' }}
                    </button>

                    <button class="fav-heart" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </button>

                    <div class="slider-wrapper" @click="openP(p)">
                        <div class="slider-inner" @scroll="e => handleScroll(e, p)">
                            <img v-for="img in p.images" :key="img" :src="img">
                        </div>
                        <div class="dots">
                            <span v-for="(img, idx) in p.images" :key="idx" class="dot" :style="{ background: idx === p.aIdx ? 'var(--accent)' : 'rgba(0,0,0,0.1)' }"></span>
                        </div>
                    </div>

                    <div class="card-info">
                        <div class="card-title">{{p.title}}</div> 
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div class="size-btns">
                            <button v-for="s in p.sizes" :key="s" @click="p.selectedSize = s; vibrate()" :class="['s-btn', p.selectedSize === s ? 'active' : '']">{{s}}</button>
                        </div>
                        <button class="buy-btn" @click="addToCart(p)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="brand-name" style="font-size: 18px; margin-bottom: 20px;">–ö–æ—Ä–∑–∏–Ω–∞</h2>
            <div v-if="cart.length === 0" style="text-align: center; padding: 50px 0;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid #eee;">
                    <img :src="item.img" style="width: 70px; height: 90px; object-fit: cover; border-radius: 12px;">
                    <div style="flex: 1;">
                        <div style="font-size: 13px; font-weight: 700;">{{item.title}}</div>
                        <div style="font-size: 11px; color: var(--gray);">–†–∞–∑–º–µ—Ä: {{item.selectedSize}}</div>
                        <div style="color: var(--accent); font-weight: 800; margin-top: 5px;">{{item.price}} ‚ÇΩ</div>
                    </div>
                    <button @click="removeC(item.cartId)" style="border:none; background:none; font-size:18px;">‚úï</button>
                </div>
                <div style="margin-top: 25px;">
                    <input class="input-c" v-model="form.name" placeholder="–í–∞—à–µ –∏–º—è" style="margin-bottom:10px;">
                    <input class="input-c" v-model="form.phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" type="tel">
                </div>
                <button class="order-btn" @click="send" :disabled="!isValid">–û–§–û–†–ú–ò–¢–¨: {{total}} ‚ÇΩ</button>
            </div>
        </div>

        <div v-if="activeTab === 'profile'">
            <div style="text-align: center; padding: 30px 0;">
                <img :src="user.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--accent);">
                <h2 style="margin-top: 10px;">{{user.first_name || '–ì–æ—Å—Ç—å'}}</h2>
            </div>

            <div v-if="isAdmin" style="margin-top: 20px; border-top: 2px solid var(--light-pink); padding-top: 20px;">
                <h3 style="text-align: center;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <input class="input-c" v-model="newP.title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                    <input class="input-c" v-model.number="newP.price" placeholder="–¶–µ–Ω–∞">
                    <select class="input-c" v-model="newP.category">
                        <option v-for="cat in categories" :key="cat" :value="cat">{{cat}}</option>
                    </select>
                    <input class="input-c" v-model="newP.sizesInput" placeholder="–†–∞–∑–º–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: 42, 44, 46)">
                    <textarea class="input-c" v-model="newP.desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                    <input type="file" @change="handleFileUpload" class="input-c">
                    <button class="buy-btn" @click="addProduct" :disabled="uploading" style="padding: 15px;">
                        {{ uploading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="selP" class="modal">
        <button class="close-m" @click="selP = null">‚úï</button>
        <div class="slider-wrapper" style="aspect-ratio: 1/1.2;">
            <div class="slider-inner" @scroll="e => handleScroll(e, selP)">
                <img v-for="img in selP.images" :key="img" :src="img">
            </div>
            <div class="dots">
                <span v-for="(img, idx) in selP.images" :key="idx" class="dot" :style="{ background: idx === selP.aIdx ? 'var(--accent)' : 'rgba(0,0,0,0.1)' }"></span>
            </div>
        </div>
        <div style="padding: 20px;">
            <h2 class="brand-name">{{selP.title}}</h2>
            <div style="font-size: 24px; color: var(--accent); font-weight: 800; margin: 10px 0;">{{selP.price}} ‚ÇΩ</div>
            <p style="font-size: 14px; line-height: 1.6; color: #666;">{{selP.desc}}</p>
            <div class="size-btns" style="margin: 20px 0;">
                <button v-for="s in selP.sizes" :key="s" @click="selP.selectedSize = s; vibrate()" :class="['s-btn', selP.selectedSize === s ? 'active' : '']" style="padding: 15px;">{{s}}</button>
            </div>
            <button class="order-btn" @click="addToCart(selP)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
    </div>

    <div v-if="activeInfo" class="modal">
        <button class="close-m" @click="activeInfo = null">‚úï</button>
        <div style="padding: 60px 20px 20px;">
            <h2 class="brand-name">{{ activeInfo === 'about' ? '–û –Ω–∞—Å' : activeInfo === 'returns' ? '–í–æ–∑–≤—Ä–∞—Ç' : '–î–æ—Å—Ç–∞–≤–∫–∞' }}</h2>
            <p style="margin-top: 20px; line-height: 1.6;">
                –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ {{ activeInfo }}. –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ–∑–∂–µ.
            </p>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'; vibrate()" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button @click="activeTab = 'cart'; vibrate()" :class="['nav-item', activeTab === 'cart' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg><span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </button>
        <button @click="activeTab = 'profile'; vibrate()" :class="['nav-item', activeTab === 'profile' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </nav>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw",
    authDomain: "naran-80077.firebaseapp.com",
    projectId: "naran-80077",
    storageBucket: "naran-80077.firebasestorage.app",
    messagingSenderId: "901156477154",
    appId: "IG-PR8PLCMF3C"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // –î–µ–ª–∞–µ–º –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
  window.db = db;
  window.fbMethods = { collection, addDoc, onSnapshot, doc, updateDoc, serverTimestamp };
</script>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                uploading: false,
                newP: { title: '', price: '', img: '', category: '–ø–∏–¥–∂–∞–∫–∏', desc: '', sizesInput: '42, 44, 46' },
                adminId: 387881523,
                isAdmin: false,
                showMenu: false,
                activeTab: 'catalog',
                activeInfo: null,
                currentCat: '',
                categories: ['–ø–∏–¥–∂–∞–∫–∏', '—Å–≤–∏—Ç–µ—Ä—ã','–∫–∞—Ä–¥–∏–≥–∞–Ω—ã', '–∫–æ—Å—Ç—é–º—ã', '–ª–æ–Ω–≥—Å–ª–∏–≤—ã', '—Ñ—É—Ç–±–æ–ª–∫–∏', '–∫–æ—Ä—Å–µ—Ç—ã', '–∫—É—Ä—Ç–∫–∏', '—ç–∫–æ—à—É–±—ã'],
                selP: null,
                user: {},
                form: { name: '', phone: '' },
                products: [],
                favorites: JSON.parse(localStorage.getItem('mimi_favs')) || [],
                cart: JSON.parse(localStorage.getItem('mimi_cart')) || []
            };
        },

        computed: {
            filteredProducts() {
                return this.products.filter(p => {
                    const catMatch = !this.currentCat || p.category === this.currentCat;
                    const visMatch = this.isAdmin || !p.hidden;
                    return catMatch && visMatch;
                });
            },
            total() {
                return this.cart.reduce((sum, item) => sum + Number(item.price), 0);
            },
            isValid() {
                return this.form.name.length > 1 && this.form.phone.length > 5 && this.cart.length > 0;
            }
        },

        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            
            handleScroll(e, p) {
                p.aIdx = Math.round(e.target.scrollLeft / e.target.offsetWidth);
            },

            toggleFav(p) {
                const idx = this.favorites.indexOf(p.id);
                if (idx > -1) this.favorites.splice(idx, 1);
                else this.favorites.push(p.id);
                localStorage.setItem('mimi_favs', JSON.stringify(this.favorites));
                this.vibrate();
            },
            isFav(p) { return this.favorites.includes(p.id); },

            openP(p) { this.selP = p; },

            addToCart(p) {
                if (!p.selectedSize) {
                    tg.showAlert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä!");
                    return;
                }
                this.cart.push({ ...p, cartId: Date.now() });
                localStorage.setItem('mimi_cart', JSON.stringify(this.cart));
                tg.HapticFeedback.notificationOccurred('success');
                this.selP = null;
            },

            removeC(cartId) {
                this.cart = this.cart.filter(item => item.cartId !== cartId);
                localStorage.setItem('mimi_cart', JSON.stringify(this.cart));
            },

            async handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                this.uploading = true;
                const formData = new FormData();
                formData.append('image', file);
                try {
                    const res = await fetch('https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();
                    if (data.success) {
                        this.newP.img = data.data.display_url;
                        tg.showAlert("–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!");
                    }
                } catch (e) {
                    tg.showAlert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ");
                } finally {
                    this.uploading = false;
                }
            },

            async addProduct() {
                if (!this.newP.img || !this.newP.title) {
                    tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ñ–æ—Ç–æ!");
                    return;
                }
                this.uploading = true;
                try {
                    const sizes = this.newP.sizesInput.split(',').map(s => s.trim());
                    const productData = {
                        title: this.newP.title,
                        price: Number(this.newP.price),
                        category: this.newP.category,
                        img: this.newP.img,
                        images: [this.newP.img], // –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ
                        sizes: sizes,
                        desc: this.newP.desc,
                        hidden: false,
                        createdAt: window.fbMethods.serverTimestamp()
                    };
                    await window.fbMethods.addDoc(window.fbMethods.collection(window.db, "products"), productData);
                    tg.showAlert("–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!");
                    this.newP = { title: '', price: '', img: '', category: '–ø–∏–¥–∂–∞–∫–∏', desc: '', sizesInput: '42, 44, 46' };
                } catch (e) {
                    tg.showAlert("–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö");
                } finally {
                    this.uploading = false;
                }
            },

            async toggleHide(p) {
                const ref = window.fbMethods.doc(window.db, "products", p.id);
                await window.fbMethods.updateDoc(ref, { hidden: !p.hidden });
            },

            send() {
                const order = {
                    user: this.form,
                    cart: this.cart,
                    total: this.total,
                    date: new Date().toLocaleString()
                };
                tg.sendData(JSON.stringify(order));
                this.cart = [];
                localStorage.removeItem('mimi_cart');
                setTimeout(() => tg.close(), 150);
            }
        },

        mounted() {
            tg.ready();
            tg.expand();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase
            const check = setInterval(() => {
                if (window.fbMethods && window.db) {
                    clearInterval(check);
                    window.fbMethods.onSnapshot(window.fbMethods.collection(window.db, "products"), (snap) => {
                        this.products = snap.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data(),
                            aIdx: 0 
                        }));
                    });
                }
            }, 100);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
            if (tg.initDataUnsafe?.user) {
                this.user = tg.initDataUnsafe.user;
                if (Number(this.user.id) === Number(this.adminId)) {
                    this.isAdmin = true;
                }
            }
        }
    }).mount('#app');
</script>

</body>
</html> 
